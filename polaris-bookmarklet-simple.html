<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ ãƒ¬ãƒ¼ãƒˆè¨ˆç®—æ©Ÿ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.8;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b9d;
            border-bottom: 3px solid #ff6b9d;
            padding-bottom: 10px;
        }
        .bookmarklet-link {
            display: inline-block;
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff6b9d, #ffa3d1);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }
        .bookmarklet-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 157, 0.4);
        }
        .code-box {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .step {
            margin: 15px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #ff6b9d;
        }
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ ãƒ¬ãƒ¼ãƒˆè¨ˆç®—æ©Ÿ<br>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆå‹•ä½œç¢ºèªæ¸ˆã¿ç‰ˆï¼‰</h1>

        <h2>ğŸ–¥ï¸ PCã§ã®ä½¿ã„æ–¹</h2>
        <div class="step">
            <strong>Step 1:</strong> ä¸‹ã®ãƒ”ãƒ³ã‚¯ã®ãƒœã‚¿ãƒ³ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <a href="" id="bookmarklet-link" class="bookmarklet-link">
                ğŸ“Š ãƒãƒ©ãƒªã‚¹ãƒ¬ãƒ¼ãƒˆè¨ˆç®—
            </a>
        </div>

        <div class="step">
            <strong>Step 2:</strong> ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ã®PA SKILLãƒšãƒ¼ã‚¸ã‚’é–‹ã
        </div>

        <div class="step">
            <strong>Step 3:</strong> ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã®ã€Œãƒãƒ©ãƒªã‚¹ãƒ¬ãƒ¼ãƒˆè¨ˆç®—ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
        </div>

        <h2>ğŸ“± ã‚¹ãƒãƒ›ã§ã®ä½¿ã„æ–¹</h2>

        <div class="step">
            <strong>Step 1:</strong> ã“ã®ãƒšãƒ¼ã‚¸ã‚’é©å½“ãªåå‰ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«ä¿å­˜
        </div>

        <div class="step">
            <strong>Step 2:</strong> ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
            <div class="code-box" id="bookmarklet-code" style="max-height: 200px; overflow-y: auto;"></div>
            <button onclick="copyCode()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>

        <div class="step">
            <strong>Step 3:</strong> ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ç·¨é›†ã—ã¦ã€URLã®éƒ¨åˆ†ã«è²¼ã‚Šä»˜ã‘
        </div>

        <div class="step">
            <strong>Step 4:</strong> ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ã®PA SKILLãƒšãƒ¼ã‚¸ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ã‚¿ãƒƒãƒ—
        </div>

        <h2>âš™ï¸ æ©Ÿèƒ½</h2>
        <ul>
            <li>å„æ¥½æ›²ã®ãƒ¬ãƒ¼ãƒˆè¨ˆç®—</li>
            <li>ç›®æ¨™ãƒ¬ãƒ¼ãƒˆã¾ã§ã«å¿…è¦ãªã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆç‡è¡¨ç¤º</li>
            <li>PA SKILLåˆ†æï¼ˆç›®æ¨™å¹³å‡ãƒ¬ãƒ¼ãƒˆè¨ˆç®—ï¼‰</li>
            <li>ã‚¹ãƒãƒ›å¯¾å¿œãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³</li>
        </ul>

        <h2>ğŸ”§ ç›®æ¨™ãƒ¬ãƒ¼ãƒˆå¤‰æ›´æ–¹æ³•</h2>
        <p>ã‚³ãƒ¼ãƒ‰ã®æœ€åˆã®éƒ¨åˆ† <code>const T=15</code> ã®æ•°å€¤ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 15.2, 16.0ãªã©ï¼‰</p>

        <h2>âš ï¸ æ³¨æ„</h2>
        <ul>
            <li>ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ã®PA SKILLãƒšãƒ¼ã‚¸ã§ã®ã¿å‹•ä½œã—ã¾ã™</li>
            <li>åˆå›å®Ÿè¡Œæ™‚ã«Google Sheetsã‹ã‚‰è­œé¢å®šæ•°ã‚’å–å¾—ã—ã¾ã™ï¼ˆæ•°ç§’ã‹ã‹ã‚Šã¾ã™ï¼‰</li>
            <li>iOSã®å ´åˆã€è¨­å®šã§ã€Œã‚µã‚¤ãƒˆè¶Šãˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’é˜²ãã€ãŒã‚ªãƒ³ã ã¨ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
        </ul>
    </div>

    <script>
        // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        const bookmarkletCode = `javascript:(function(){const T=15;function calcRate(c,a){const r=parseFloat(a);let s=0;if(r>=99.5)s=(r-99.5)*0.6+2;else if(r>=98)s=(r-98)+0.5;else if(r>=95)s=(r-95)*0.166;else if(r>=85)s=(r-85)*0.1;return c+s}function calcReq(c,t){const rc=t-c;if(calcRate(c,100)<t)return null;if(rc>=2){const r=99.5+(rc-2)/0.6;if(r<=100)return r}if(rc>=0.5){const r=98+(rc-0.5);if(r<99.5)return r;return 99.5+(rc-2)/0.6}if(rc>=0){const r=95+rc/0.166;if(r<98)return r;return 98+(rc-0.5)}if(rc>0){const r=85+rc/0.1;if(r<=95)return r;return 95+rc/0.166}return null}let cc={};function norm(n){return n.trim().replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0)).replace(/ï¼/g,'!').replace(/ï¼Ÿ/g,'?').replace(/ï¼š/g,':').replace(/\\s+/g,' ').trim()}function parseTSV(txt){const c={};const ls=txt.split('\\n');for(let i=1;i<ls.length;i++){const l=ls[i].trim();if(!l)continue;const cols=l.split('\\t');let sn='',inf='',hrd='',diff='';if(cols.length>=5&&cols[1]&&cols[0].match(/^\\d+$/)){sn=cols[1].trim();diff=cols[2]?cols[2].trim().toUpperCase():'';inf=cols[4]?cols[4].trim():'';hrd=cols[6]?cols[6].trim():'';}else if(cols.length>=4&&cols[0]&&!cols[0].match(/^\\d+$/)){sn=cols[0].trim();diff=cols[1]?cols[1].trim().toUpperCase():'';inf=cols[3]?cols[3].trim():'';hrd=cols[5]?cols[5].trim():'';}if(sn){const nn=norm(sn);if(diff&&(diff==='INF'||diff==='INFLUENCE')){if(inf&&inf!=='-'){const ct=parseFloat(inf);if(!isNaN(ct))c[nn+'_INF']=ct;}}else if(diff&&(diff==='HARD'||diff==='HRD')){if(inf&&inf!=='-'){const ct=parseFloat(inf);if(!isNaN(ct))c[nn+'_HARD']=ct;}}else{if(inf&&inf!=='-'){const ct=parseFloat(inf);if(!isNaN(ct))c[nn+'_INF']=ct;}if(hrd&&hrd!=='-'){const ct=parseFloat(hrd);if(!isNaN(ct))c[nn+'_HARD']=ct;}}}}return c}async function fetchCC(){try{const r=await fetch('https://docs.google.com/spreadsheets/d/1nC9tfgg0vTQttDCACbZr9aDWKWjEtk676ZlRVW-glUk/export?format=tsv&gid=512804297',{mode:'cors'});if(!r.ok)throw new Error('HTTP '+r.status);const txt=await r.text();cc=parseTSV(txt);return cc;}catch(e){alert('è­œé¢å®šæ•°å–å¾—å¤±æ•—');throw e;}}function extractScores(){const sc=[];document.querySelectorAll('.music_data').forEach(el=>{const snEl=el.querySelector('.title_name');const achEl=el.querySelector('.achievement_rate.rate');let diff='UNKNOWN';if(el.classList.contains('influence'))diff='INF';else if(el.classList.contains('hard'))diff='HARD';if(snEl&&achEl){sc.push({element:el,songName:snEl.textContent.trim(),achievement:parseFloat(achEl.textContent.trim()),difficulty:diff});}});return sc}function showPA(rates){const paEl=document.querySelector('.pa_skill span');if(!paEl)return;const curPA=parseFloat(paEl.textContent);const top30=rates.sort((a,b)=>b-a).slice(0,30);const below=top30.filter(r=>r<T);const above=top30.filter(r=>r>=T);const curAvg=below.length>0?below.reduce((s,r)=>s+r,0)/below.length:0;const aboveSum=above.reduce((s,r)=>s+r,0);let reqAvg=0;if(below.length>0)reqAvg=(T*30-aboveSum)/below.length;const box=document.createElement('div');box.className='pa-skill-analysis-box';box.style.cssText='background:white;border:2px solid #ddd;border-radius:8px;padding:20px;margin:20px 0;box-shadow:0 2px 8px rgba(0,0,0,0.1)';const st=curPA>=T?'é”æˆæ¸ˆã¿ï¼':'æœªé”æˆ';const sc=curPA>=T?'#4CAF50':'#FF6F00';box.innerHTML='<h3 style="margin:0 0 15px 0;font-size:18px;color:#333;border-bottom:2px solid #ff7bc0;padding-bottom:8px">PA SKILLåˆ†æ</h3><div style="font-size:16px;color:#333;line-height:1.8"><p style="margin:8px 0"><strong>ç¾åœ¨ã®PA SKILL:</strong> <span style="font-size:20px;color:#ff7bc0;font-weight:bold">'+curPA.toFixed(2)+'</span></p><p style="margin:8px 0"><strong>ç›®æ¨™PA SKILL:</strong> <span style="font-size:20px;color:'+sc+';font-weight:bold">'+T.toFixed(1)+'</span> <span style="color:'+sc+';font-weight:bold;margin-left:10px">('+st+')</span></p><hr style="border:none;border-top:1px solid #eee;margin:15px 0">'+(below.length>0?'<p style="margin:8px 0"><strong>ç›®æ¨™ãƒ¬ãƒ¼ãƒˆæœªæº€ï¼ˆ&lt; '+T.toFixed(1)+'ï¼‰ã®æ¥½æ›²æ•°:</strong> <span style="font-size:18px;color:#666;font-weight:bold">'+below.length+'æ›²</span> <span style="color:#999;font-size:14px;margin-left:10px">/ 30æ›²ä¸­</span></p><p style="margin:8px 0"><strong>ç¾åœ¨ã®å¹³å‡ãƒ¬ãƒ¼ãƒˆ:</strong> <span style="font-size:18px;color:#666;font-weight:bold">'+curAvg.toFixed(2)+'</span></p>'+(curPA<T?'<p style="margin:8px 0"><strong>æœªé”æˆæ›²ã®ç›®æ¨™å¹³å‡ãƒ¬ãƒ¼ãƒˆ:</strong> <span style="font-size:18px;color:#FF6F00;font-weight:bold">'+reqAvg.toFixed(2)+'</span> <span style="color:#999;font-size:14px;margin-left:10px">(+'+(reqAvg-curAvg).toFixed(2)+')</span></p>':''):'<p style="margin:8px 0;color:#4CAF50;font-weight:bold">å…¨ã¦ã®æ¥½æ›²ãŒç›®æ¨™ãƒ¬ãƒ¼ãƒˆä»¥ä¸Šã‚’é”æˆã—ã¦ã„ã¾ã™ï¼</p>')+'</div>';const old=document.querySelector('.pa-skill-analysis-box');if(old)old.remove();const pn=document.getElementById('pa-notice');const mb=document.querySelector('.music_data_box');if(pn&&mb)pn.parentNode.insertBefore(box,mb);}function calcRates(){const scs=extractScores();let suc=0,fail=0;const allR=[];scs.forEach(sc=>{const nn=norm(sc.songName);const key=nn+'_'+sc.difficulty;const c=cc[key];if(c!==undefined){const rate=calcRate(c,sc.achievement);allR.push(rate);const rd=document.createElement('span');rd.textContent=' [Rate: '+rate.toFixed(2)+']';rd.style.cssText='color:white;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.8);margin-left:10px;font-size:12px';rd.className='rate-display';const ti=document.createElement('div');if(rate>=T){ti.textContent='ç›®æ¨™'+T.toFixed(1)+': é”æˆï¼';ti.style.color='#FFFFFF';}else{const gap=T-rate;const req=calcReq(c,T);if(req!==null&&req<=100)ti.textContent='ç›®æ¨™'+T.toFixed(1)+'ã¾ã§: +'+gap.toFixed(2)+' (è¦'+req.toFixed(2)+'%)';else ti.textContent='ç›®æ¨™'+T.toFixed(1)+'ã¾ã§: +'+gap.toFixed(2)+' (100%ã§ã‚‚ä¸å¯)';ti.style.color='#FFCC80';}ti.style.cssText+='font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.8);font-size:11px;margin-left:10px;margin-top:2px';ti.className='target-info-display';const old1=sc.element.querySelector('.rate-display');if(old1)old1.remove();const old2=sc.element.querySelector('.target-info-display');if(old2)old2.remove();const snEl=sc.element.querySelector('.title_name');if(snEl){snEl.appendChild(rd);snEl.appendChild(ti);suc++;}}else{fail++;}});if(allR.length>0)showPA(allR);const res=document.createElement('div');res.style.cssText='position:fixed;top:80px;right:20px;background:rgba(0,0,0,0.8);color:white;padding:10px;border-radius:5px;z-index:10000;font-size:12px';res.textContent='æˆåŠŸ: '+suc+'ä»¶, å¤±æ•—: '+fail+'ä»¶';document.body.appendChild(res);setTimeout(()=>res.remove(),5000);}if(!window.location.href.includes('p.eagate.573.jp/game/polarischord/pc/playdata/pa_skill.html')){alert('ã“ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãƒãƒ©ãƒªã‚¹ã‚³ãƒ¼ãƒ‰ã®PA SKILLãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');return;}const ld=document.createElement('div');ld.style.cssText='position:fixed;top:20px;right:20px;background:linear-gradient(45deg,#ff6b9d,#ffa3d1);color:white;padding:12px 20px;border-radius:25px;z-index:10000;font-weight:bold;box-shadow:0 4px 12px rgba(255,107,157,0.3)';ld.textContent='è­œé¢å®šæ•°å–å¾—ä¸­...';document.body.appendChild(ld);fetchCC().then(()=>{ld.textContent='ãƒ¬ãƒ¼ãƒˆè¨ˆç®—ä¸­...';calcRates();ld.textContent='è¨ˆç®—å®Œäº†ï¼';ld.style.background='#4CAF50';setTimeout(()=>ld.remove(),3000);}).catch(e=>{console.error(e);ld.textContent='ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ';ld.style.background='#f44336';setTimeout(()=>ld.remove(),5000);});})();`;

        // ãƒªãƒ³ã‚¯ã¨ã‚³ãƒ¼ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã«è¨­å®š
        document.getElementById('bookmarklet-link').href = bookmarkletCode;
        document.getElementById('bookmarklet-code').textContent = bookmarkletCode;

        function copyCode() {
            const code = document.getElementById('bookmarklet-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®URLæ¬„ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
            }).catch(() => {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                const textarea = document.createElement('textarea');
                textarea.value = code;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('âœ… ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®URLæ¬„ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
            });
        }
    </script>
</body>
</html>